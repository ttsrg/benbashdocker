FROM ubuntu:16.04 
MAINTAINER SergBen (ttserg@gmail.com) 

ARG APP_VER
ARG NGINX_VER=$APP_VER



RUN apt-get update && \ 
    apt-get install -y  wget  gcc  make  && \ 
    wget -O nginx.tar.gz http://nginx.org/download/nginx-$NGINX_VER.tar.gz &&\
    tar -xzf nginx.tar.gz -C /tmp/ && cd /tmp/nginx-$NGINX_VER &&\
    cd /tmp/nginx-$NGINX_VER && ./configure --without-http_rewrite_module --without-http_gzip_module &&\
    make && make install && rm -rf /tmp/nginx-$NGINX_VER /nginx.tar.gz  &&\
    apt-get -y  autoremove && apt-get -y  autoclean



COPY nginxUbuntuDocfile /
### !!!ansible takes files from files/
#COPY files/nginx.conf /usr/local/nginx/conf/
COPY nginx.conf /usr/local/nginx/conf/

#RUN ln -sf /dev/stdout /usr/local/nginx/logs/access.log \
#    && ln -sf /dev/stderr /usr/local/nginx/logs/error.log


EXPOSE 80

STOPSIGNAL SIGTERM

CMD ["/usr/local/nginx/sbin/nginx", "-g", "daemon off;"]

